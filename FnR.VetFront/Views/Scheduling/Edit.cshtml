@using FnR.Models
@model FnR.Models.Schedule

@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_VetLayout.cshtml";
}



@section styles
{
    <link href="~/Content/MyStyles/scheduling.css" rel="stylesheet" />
}

@section scripts
{
    <script src="~/Scripts/MyScripts/scheduling.js"></script>
}

<div id="edit-schedule">
    <h2>Edit</h2>

    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true)

        <div class="fieldset-container">
            <fieldset>
                <legend>Schedule</legend>

                @Html.HiddenFor(model => model.Id)

                <div class="editor-label">
                    @Html.LabelFor(model => model.Doctor)
                </div>
                <div class="editor-field">
                    @Html.DropDownListFor(model => model.DoctorId, (SelectList)ViewBag.Doctors, "-- Assign to Doctor --")
                    @*@Html.ValidationMessageFor(model => model.DoctorId)*@
                </div>

                <div class="editor-label">
                    @Html.LabelFor(model => model.Name)
                </div>
                <div class="editor-field">
                    @Html.EditorFor(model => model.Name)
                    @Html.ValidationMessageFor(model => model.Name)
                </div>

                <div class="editor-label">
                    @Html.LabelFor(model => model.Description)
                </div>
                <div class="editor-field">
                    @Html.EditorFor(model => model.Description)
                    @Html.ValidationMessageFor(model => model.Description)
                </div>
                @*@Html.HiddenFor(model => model.VetId)*@

                <div style="clear: both;">
                    <input type="submit" value="Save" />
                </div>
            </fieldset>
        </div>
    }
    <div id="schedule-events">
        <h3>Events</h3>
        <table>
            <thead>
                <tr>
                    <th>Event Title</th>
                    <th>Start Date / Time</th>
                    <th>End Date / Time</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var schedEvent in Model.Events)
                {
                    <tr>
                        <td>@schedEvent.Title</td>
                        <td>@schedEvent.StartDateTime.ToShortDateString() - @schedEvent.StartDateTime.ToLongTimeString()</td>
                        <td>@schedEvent.EndDateTime.ToShortDateString() - @schedEvent.EndDateTime.ToLongTimeString()</td>
                        <td>
                            @Html.ActionLink("Remove", "DeleteEvent", "Scheduling", new { id = schedEvent.Id, redirectIndex = false }, null)
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        @using (Html.BeginForm("CreateEvent", "Scheduling"))
        {
            <input type="hidden" name="ScheduleId" value="@Model.Id"/>
            <label for="Title">Title: </label>
            <input type="text" id="Title" name="Title" /><br />
            <label for="StartDateTime">Start Date / Time (mm/dd/yyyy HH:MM): </label>
            <input type="text" id="StartDateTime" name="StartDateTime" /><br />
            <label for="EndDateTime">End Date / Time (mm/dd/yyyy HH:MM): </label>
            <input type="text" id="EndDateTime" name="EndDateTime" /><br />
            <input type="submit" value="Create Event" />
        }
    </div>


    <div id="schedule-users">
        <h3>Users</h3>
        <table>
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model.Users)
                {
                    <tr>
                        <td>@user.FirstName</td>
                        <td>@user.LastName</td>
                        <td>
                            @Html.ActionLink("Unassign", "Unassign", "Scheduling", new { userId = user.Id, schedId = Model.Id }, null)
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        @using (Html.BeginForm("AssignSchedule", "Scheduling"))
        {
            <input type="hidden" name="ScheduleId" value="@Model.Id"/>
            <select id="UserId" name="UserId">
                @foreach (var user in ViewBag.UserList as List<User>)
                {
                    if (Model.Users.SingleOrDefault(r => r.Id == user.Id) == null)
                    {
                    <option value="@user.Id">@user.FullName</option>
                    }
                }
            </select>
            <input type="submit" value="Assign" />
        }
    </div>

    <div>
        @Html.ActionLink("<< Back to List", "Index")
    </div>
</div>
